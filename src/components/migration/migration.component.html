<!-- Top Bar -->
<header class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b shadow-sm">
  <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <!-- <div class="h-8 w-8 rounded-xl bg-[#052c65]" aria-hidden="true"></div> -->
      <span class="text-sm font-semibold tracking-wide">Eerly AI · ECC → Cloud Migration</span>
    </div>
    <div class="flex items-center gap-2 text-sm">
      <span class="text-gray-600">Initech ECC (LEG-442)</span>
      <span class="text-gray-300">•</span>
      <span id="targetLabel" class="text-gray-600">{{ selectedTargetLabel }}</span>
    </div>
  </div>
</header>

<!-- Stepper -->
<div class="mx-auto max-w-7xl px-4 pt-5">
  <div class="bg-white border rounded-2xl p-3 grid grid-cols-7 gap-2 text-xs font-medium">
    <button *ngFor="let s of screens; let i = index"
            (click)="switchTo(s)"
            class="px-2 py-1 rounded"
            [ngClass]="active === s ? 'bg-gray-100 text-gray-900' : 'text-gray-600 hover:bg-gray-50'">
      {{ i + 1 }}. {{ labels[i] }}
    </button>
  </div>
</div>

<!-- Main -->
<main class="mx-auto max-w-7xl px-4 py-6 space-y-8">
  <!-- HOME -->
  <section *ngIf="active === 'HOME'" class="space-y-6">
    <div class="grid grid-cols-4 gap-4">
      <div class="bg-white rounded-xl border p-4">
        <div class="text-xs text-gray-500">Customer</div>
        <div class="text-2xl font-semibold">Initech ECC</div>
        <div class="text-xs text-gray-500">LEG-442</div>
      </div>
      <div class="bg-white rounded-xl border p-4">
        <div class="text-xs text-gray-500">Legacy System</div>
        <div class="text-2xl font-semibold">ECC 6.0</div>
        <div class="text-xs text-gray-500">Client 100</div>
      </div>
      <div class="bg-white rounded-xl border p-4">
        <div class="text-xs text-gray-500">Target</div>
        <div id="homeTarget" class="text-2xl font-semibold">{{ selectedTargetLabel }}</div>
      </div>
      <div class="bg-white rounded-xl border p-4">
        <div class="text-xs text-gray-500">Status</div>
        <div class="text-2xl font-semibold text-amber-600">Scan pending</div>
      </div>
    </div>

    <div class="bg-white rounded-xl border p-6">
      <div class="font-semibold text-gray-800">Choose your target landing</div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
        <label *ngFor="let t of targets" class="p-4 border rounded-xl cursor-pointer hover:border-gray-400 block">
          <div class="flex items-center gap-3">
            <input type="radio" name="tgt" [(ngModel)]="selectedTarget" [value]="t.id"/>
            <div class="font-medium text-gray-800">{{ t.label }}</div>
          </div>
          <div class="text-sm text-gray-600 mt-1">{{ t.desc }}</div>
        </label>
      </div>
    </div>

    <div class="grid grid-cols-12 gap-6">
      <aside class="col-span-12 md:col-span-3 bg-white rounded-xl border p-4 h-fit">
        <div class="font-semibold text-gray-800 mb-2">Checklist</div>
        <ul id="homeChecklist" class="space-y-2 text-sm text-gray-700">
          <li *ngFor="let c of checklist" class="flex items-center justify-between">
            <span>{{ c.label }}</span>
            <span class="text-xs px-2 py-0.5 rounded-full border">{{ c.status }}</span>
          </li>
        </ul>
      </aside>

      <main class="col-span-12 md:col-span-9 bg-white rounded-xl border p-6">
        <div class="font-semibold text-gray-800">What Eerly will do</div>
        <ul class="list-disc pl-6 text-sm text-gray-700 mt-2 space-y-1">
          <li>Inventory modules, org units, transports, Z-objects</li>
          <li>Map ECC features to S/4/SF standard capabilities</li>
          <li>Propose redesigns & de-customizations with effort/risk</li>
          <li>Assemble a migration roadmap and test coverage plan</li>
        </ul>
        <button class="mt-4 px-4 py-2 text-white rounded-lg" style="background:#052c65" (click)="switchTo('SCAN')">Start Legacy Scan</button>
      </main>
    </div>
  </section>

  <!-- SCAN -->
  <section *ngIf="active === 'SCAN'">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-semibold text-gray-800">Legacy Scan</h2>
      <button class="px-3 py-1 border rounded-lg" (click)="switchTo('HOME')">Back</button>
    </div>

    <div class="grid grid-cols-3 gap-4">
      <div class="col-span-2 bg-white border rounded-xl p-4">
        <div class="font-semibold text-gray-800">Progress</div>
        <div class="mt-3 w-full bg-gray-100 rounded-full h-3 overflow-hidden">
          <div class="h-3" style="background:#052c65" [style.width.%]="scanPct"></div>
        </div>
        <div id="scanPct" class="text-xs text-gray-500 mt-1">{{ scanPct }}%</div>

        <div id="scanEvents" class="mt-3 space-y-2 text-sm text-gray-700">
          <div *ngFor="let e of scanEvents" class="border rounded p-2">{{ e }}</div>
        </div>

        <div class="mt-4 flex justify-end">
          <button id="scanNext"
                  class="px-6 py-2 rounded-lg"
                  [disabled]="scanPct < 100"
                  [ngClass]="scanPct < 100 ? 'bg-gray-200 text-gray-500' : 'text-white'"
                  [style.background]="scanPct === 100 ? '#052c65' : ''"
                  (click)="switchTo('FITGAP')">View Fit-Gap</button>
        </div>
      </div>

      <div class="bg-white border rounded-xl p-4">
        <div class="font-semibold text-gray-800">Scope</div>
        <ul class="list-disc pl-6 text-sm text-gray-700 mt-2 space-y-1">
          <li>FIN: GL, AP, AR, AA</li>
          <li>LOG: MM, SD</li>
          <li>HR (optional): PA/OM/Payroll</li>
        </ul>
        <div class="mt-3 flex gap-2">
          <button id="scanStart" class="px-3 py-1 border rounded" (click)="startScan()">Start</button>
          <button id="scanReset" class="px-3 py-1 border rounded" (click)="resetScan()">Reset</button>
        </div>
      </div>
    </div>
  </section>

  <!-- FITGAP -->
  <section *ngIf="active === 'FITGAP'">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-800">Fit-Gap & Target Compare</h2>
      <div>
        <button class="px-3 py-1 border rounded-lg" (click)="switchTo('SCAN')">Back</button>
        <button class="px-3 py-1 rounded-lg text-white" style="background:#052c65" (click)="switchTo('BLUEPRINT')">Build Blueprint</button>
      </div>
    </div>

    <div id="fitRows" class="mt-4 space-y-3">
      <div *ngFor="let m of fitItems" class="bg-white border rounded-xl p-4">
        <div class="flex items-center justify-between">
          <div class="font-semibold text-gray-800">{{ m.area }}</div>
          <span class="text-xs px-2 py-0.5 rounded-full"
                [ngClass]="m.fit >= 70 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'">
            {{ m.fit }}% fit
          </span>
        </div>
        <div class="grid grid-cols-3 gap-3 mt-3 text-sm">
          <div>
            <div class="text-xs text-gray-500 mb-1">ECC (as-is)</div>
            <ul class="list-disc pl-6 text-gray-700 space-y-1"><li *ngFor="let e of m.ecc">{{ e }}</li></ul>
          </div>
          <div>
            <div class="text-xs text-gray-500 mb-1">Target ({{ selectedTargetLabel }})</div>
            <ul class="list-disc pl-6 text-gray-700 space-y-1"><li *ngFor="let t of m.target">{{ t }}</li></ul>
          </div>
          <div>
            <div class="text-xs text-gray-500 mb-1">Action</div>
            <div class="text-gray-800">{{ m.action }}</div>
            <div class="mt-2 text-xs text-gray-500">Risk: {{ m.risk }}</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BLUEPRINT -->
  <section *ngIf="active === 'BLUEPRINT'">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-800">Migration Blueprint</h2>
      <div>
        <button class="px-3 py-1 border rounded-lg" (click)="switchTo('FITGAP')">Back</button>
        <button id="bpContinue"
                class="px-3 py-1 rounded-lg text-white"
                [ngClass]="bpReady ? '' : 'bg-gray-300 cursor-not-allowed'"
                [style.background]="bpReady ? '#052c65' : ''"
                (click)="continueFromBlueprint()"
                >Continue</button>
      </div>
    </div>

    <div id="bpList" class="mt-3 space-y-3">
      <div *ngFor="let s of bp; let i = index" class="bg-white border rounded-xl p-4">
        <div class="flex items-center justify-between">
          <div class="font-semibold text-gray-800">{{ s.from }} → {{ s.to }}</div>
          <div class="flex items-center gap-2 text-xs">
            <span class="px-2 py-0.5 rounded-full"
                  [ngClass]="s.impact === 'High' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'">Impact: {{ s.impact }}</span>
            <span class="px-2 py-0.5 rounded-full"
                  [ngClass]="s.effort === 'L' ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'">Effort: {{ s.effort }}</span>
            <label class="text-sm flex items-center gap-2">
              <input type="checkbox" [(ngModel)]="s.accepted" name="bpAccept{{i}}" (ngModelChange)="updateBpReady()"/>
              Accept
            </label>
          </div>
        </div>
        <div class="mt-2 text-sm text-gray-700">Outline tasks, transports, and test coverage to move from as-is to target standard.</div>
      </div>
    </div>
  </section>

  <!-- DATAINT -->
  <section *ngIf="active === 'DATAINT'">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-800">Data & Integration Readiness</h2>
      <div>
        <button class="px-3 py-1 border rounded-lg" (click)="switchTo('BLUEPRINT')">Back</button>
        <button class="px-3 py-1 text-white rounded-lg" style="background:#052c65" (click)="switchTo('ROADMAP')">View Roadmap</button>
      </div>
    </div>

    <div class="grid grid-cols-3 gap-4 mt-4">
      <div class="bg-white border rounded-xl p-4"><div class="font-semibold mb-1">Data Volumes</div><div class="text-sm text-gray-600">FI: 2,000,000 • HR: 1,200,000 • LOG: 500,000</div></div>
      <div class="bg-white border rounded-xl p-4"><div class="font-semibold mb-1">Quality Signals</div><div class="text-sm text-gray-600">15% vendor master missing IBAN • 10% customer duplicates</div><button class="mt-2 px-3 py-1 border rounded text-xs">Open Data Fix Plan</button></div>
      <div class="bg-white border rounded-xl p-4"><div class="font-semibold mb-1">Integrations</div><div class="text-sm text-gray-600">12 interfaces found • 4 require redesign</div><button class="mt-2 px-3 py-1 border rounded text-xs">Open Mapping Center</button></div>
    </div>
  </section>

  <!-- ROADMAP -->
  <section *ngIf="active === 'ROADMAP'">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-800">Migration Roadmap</h2>
      <div>
        <button class="px-3 py-1 border rounded-lg" (click)="switchTo('DATAINT')">Back</button>
        <button class="px-3 py-1 text-white rounded-lg" style="background:#052c65" (click)="switchTo('SIGN')">Proceed to Sign-Off</button>
      </div>
    </div>

    <div id="phaseList" class="bg-white border rounded-xl p-4 mt-3">
      <div *ngFor="let p of phases; let i = index" class="grid grid-cols-12 gap-3 items-center mb-2">
        <input class="col-span-4 border rounded px-2 py-1" [(ngModel)]="p.name" />
        <input type="number" class="col-span-2 border rounded px-2 py-1" [(ngModel)]="p.months" (ngModelChange)="updatePhaseMonths(i, $event)" />
        <input class="col-span-6 border rounded px-2 py-1" [(ngModel)]="p.notes" />
      </div>
    </div>

    <div class="mt-2 text-sm text-gray-600">Estimated total timeline: <span id="phaseTotal" class="font-semibold">{{ totalPhaseMonths }}</span> months</div>
  </section>

  <!-- SIGN -->
  <section *ngIf="active === 'SIGN'">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-800">Migration Plan Sign-Off</h2>
      <div>
        <button class="px-3 py-1 border rounded-lg" (click)="switchTo('ROADMAP')">Back</button>
        <button id="signBtn" class="px-3 py-1 rounded-lg text-white" [ngClass]="signReady ? '' : 'bg-gray-300 cursor-not-allowed'" [style.background]="signReady ? '#052c65' : ''" (click)="signOff()" [disabled]="!signReady">Sign-Off & Generate Playbook</button>
      </div>
    </div>

    <div id="approvals" class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
      <div *ngFor="let a of approvers; let i = index" class="bg-white border rounded-xl p-4 flex items-center justify-between">
        <div>
          <div class="font-medium text-gray-800">{{ a.name }}</div>
          <div class="text-xs text-gray-500">{{ a.role }}</div>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-xs px-2 py-0.5 rounded-full" [ngClass]="a.status === 'approved' ? 'bg-green-100 text-green-700' : a.status === 'rejected' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700'">{{ a.status }}</span>
          <div class="flex gap-1">
            <button class="px-2 py-1 rounded border text-xs" (click)="approverAction(i, 'approved')">Approve</button>
            <button class="px-2 py-1 rounded border text-xs" (click)="approverAction(i, 'rejected')">Reject</button>
          </div>
        </div>
      </div>
    </div>

    <aside class="mt-4 bg-white border rounded-xl p-4">
      <div class="font-semibold text-gray-800">Handoff</div>
      <div class="text-sm text-gray-600 mt-1">When signed, Eerly stores a handoff token so your Workspace opens to the right version.</div>
      <div class="mt-2 flex gap-2">
        <button id="openWS" class="px-3 py-1 border rounded" (click)="openWorkspace()">Open Workspace</button>
        <button id="openHere" class="px-3 py-1 border rounded" (click)="openHerePostView()">Open here with ?view=post</button>
      </div>
    </aside>
  </section>
</main>
